<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" template="/WEB-INF/templates/default.xhtml">

<ui:define name="zonaJavaScript">
<script type="text/javascript">
function sumaRebajas(){
	var suma = parseInt(document.getElementById("rebajasForm:tablaMisTareas:0:final1").value)+parseInt(document.getElementById("rebajasForm:tablaMisTareas:0:final2").value)+parseInt(document.getElementById("rebajasForm:tablaMisTareas:0:final3").value);
	alert(suma);
	document.getElementById("rebajasForm:tablaMisTareas:0:totalFinal").value = suma;
	
}
</script>
</ui:define>
	<ui:define name="content">
		<h:form enctype="multipart/form-data" id="rebajasForm">
			<p:panel styleClass="contentPanel">
				<h1>
					<h:outputText value="Rebaja" />
				</h1>
				<p:panel id="Panel">
					<h2>
						<strong>Actividad:</strong> Revisión y Validación de los Montos de Rebaja
					</h2>
					<p class="parrafo">La planilla de Montos de Distribución contiene lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent
						egestas tempor nulla eget ultricies. Morbi pulvinar elit Maecenas sollicitudin odio imperdiet orci sollicitudin convallis. Etiam
						hendrerit, tellus a lacinia dignissim, justo nisi porttitor enim, eget ullamcorper felis augue eget lacus.</p>
					<br />

					<div class="destacaArchivos ui-corner-all">
						<h3>Archivos disponibles para la Tarea:</h3>
						<span class="strong">Archivo: </span> Planilla Montos de Rebaja [
						<h:graphicImage value="resources/minsal/images/download-alt.png" styleClass="divapIcons" />
						<h:commandLink action="#{procesoRebajaValidarMontosController.downloadExcelRebaja}" value="Bajar">
						    <f:setPropertyActionListener target="#{procesoRebajaValidarMontosController.docIdDownload}"
								value="#{procesoRebajaValidarMontosController.docRebaja}" />
						</h:commandLink>]
						<ul class="versionesArchivo">
							<li>No existen versiones anteriores</li>
						</ul>
					</div>
					<h3>Visualizador: Montos de Rebaja</h3>
					<!-- INICIO: MODAL CON INFORMACIóN Y FILTROS VISTA ONLINE -->

					<p:panel styleClass="appMenu">
						<h4>Filtros de Búsqueda:</h4>
						<h:panelGrid columns="4" id="busqueda_mis_tareas">
							<h:panelGrid columns="2">
								<h:outputText value="Región: " styleClass="inputLabel" />
								<p:selectOneMenu value="#{procesoRebajaValidarMontosController.regionSeleccionada}">
								<p:ajax listener="#{procesoRebajaValidarMontosController.cargaServicios}" update="servicios comunas" />
								<f:selectItem itemLabel="Seleccione" itemValue="" />  
								<f:selectItems value="#{procesoRebajaValidarMontosController.listaRegiones}" itemLabel="#{region.descRegion}" var="region" itemValue="#{region.idRegion}"/> 
							</p:selectOneMenu>
							</h:panelGrid>

							<h:panelGrid columns="2">
								<h:outputText value="Servicio: " styleClass="inputLabel" />
								<p:selectOneMenu id="servicios"  value="#{procesoRebajaValidarMontosController.servicioSeleccionado}">
								<p:ajax listener="#{procesoRebajaValidarMontosController.cargaComunas}" update="comunas" />
								<f:selectItem itemLabel="Seleccione" itemValue="" />  
								<f:selectItems value="#{procesoRebajaValidarMontosController.listaServicios}" itemLabel="#{servicio.nombre_servicio}" var="servicio" itemValue="#{servicio.id_servicio}"/> 
							</p:selectOneMenu>
							</h:panelGrid>

							<h:panelGrid columns="2">
								<h:outputText value="Comuna: " styleClass="inputLabel" />
								<p:selectCheckboxMenu id="comunas" value="#{procesoRebajaValidarMontosController.comunasSeleccionadas}" label="Seleccione" filter="true" filterText="Filter"
									filterMatchMode="startsWith">
									<f:selectItems value="#{procesoRebajaValidarMontosController.listaComunas}" itemLabel="#{comuna.descComuna}" var="comuna" itemValue="#{comuna.idComuna}"/>
								</p:selectCheckboxMenu>
							</h:panelGrid>

							<h:panelGrid columns="2">
							<p:commandButton value="Buscar" styleClass="x-btn-text" icon="ui-icon-search"
							actionListener="#{procesoRebajaValidarMontosController.buscarRebaja}" ajax="false" update="tablaMisTareas"/>
								<p:commandButton value="Limpiar" styleClass=" x-btn-text icon-guardar" update="tablaMisTareas" icon="ui-icon-trash" />
							</h:panelGrid>

						</h:panelGrid>
					</p:panel>
					<br />
					<p:dataTable id="tablaMisTareas" resizableColumns="true" value="#{procesoRebajaValidarMontosController.rebajaComunas}" liveResize="true" var="_rebaja"
						rows="10" paginator="false" paginatorPosition="bottom" emptyMessage="No se encontro información." styleClass="dataTable">
						<p:columnGroup type="header">
							<!--  -->
							<p:row>
								<p:column rowspan="2" headerText="Comuna" />
								<p:column rowspan="2" headerText="Aporte Estatal {MAYO}" />
								<p:column colspan="3" headerText="Cumplimiento" />
								<p:column colspan="4" headerText="Rebaja Calculada" />
								<p:column colspan="4" headerText="Rebaja Final" />
								<p:column rowspan="2" headerText="Monto Rebaja {MAYO}" />
								<p:column rowspan="2" headerText="Nuevo Aporte Estatal {MAYO}" />
								<p:column rowspan="2" headerText="Guardar" />
							</p:row>
							<p:row>
								<p:column headerText="item1" />
								<p:column headerText="item2" />
								<p:column headerText="item3" />

								<p:column headerText="reb1" />
								<p:column headerText="reb2" />
								<p:column headerText="reb3" />
								<p:column headerText="total" />

								<p:column headerText="reb ex1" />
								<p:column headerText="reb ex2" />
								<p:column headerText="reb ex3" />
								<p:column headerText="total" />
								
								
							</p:row>
						</p:columnGroup>
						<p:column><h:outputText value="#{_rebaja.descComuna}"  styleClass="textoPequenio textoAjustado" /></p:column>
						<p:column>
							<h:outputText value="#{_rebaja.aporteEstatal}" styleClass="textoPequenio textoAjustado">
								<f:convertNumber type="currency" maxFractionDigits="0" locale="es_CL" currencySymbol="$" />
							</h:outputText>
						</p:column>
						
						<p:column>
							<h:outputText value="#{_rebaja.cumplimientoItem1}" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>
						<p:column>
							<h:outputText value="#{_rebaja.cumplimientoItem2}" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>
						<p:column>
							<h:outputText value="#{_rebaja.cumplimientoItem3}" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>
						<p:column>
							<h:outputText value="#{_rebaja.rebajaCalculada1}" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>
						<p:column>
							<h:outputText value="#{_rebaja.rebajaCalculada2}" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>
						<p:column>
							<h:outputText value="#{_rebaja.rebajaCalculada3}" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>
						<p:column>
							<h:outputText value="#{_rebaja.rebajaCalculada1 + _rebaja.rebajaCalculada2 + _rebaja.rebajaCalculada3}" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>

						<p:column>
							<h:inputText id="final1" value="#{_rebaja.rebajaFinal1}" styleClass="textoPequenioInput textoAjustado" style="width:30px" >
							</h:inputText>
						</p:column>
						<p:column>
							<h:inputText id="final2" value="#{_rebaja.rebajaFinal2}" styleClass="textoPequenioInput textoAjustado" style="width:30px" >
							</h:inputText>
						</p:column>
						<p:column>
							<h:inputText id="final3" value="#{_rebaja.rebajaFinal3}" styleClass="textoPequenioInput textoAjustado"  style="width:30px" >
							</h:inputText>
						</p:column>

						<p:column>
							<h:outputText id="totalFinal" value="" styleClass="textoPequenio textoAjustado">
							</h:outputText>
						</p:column>

						<p:column>
							<h:outputText value="" styleClass="textoPequenio textoAjustado">
								<f:convertNumber type="currency" maxFractionDigits="0" locale="es_CL" currencySymbol="$" />
							</h:outputText>
						</p:column>
						<p:column>
							<h:outputText value="" styleClass="textoPequenio textoAjustado">
								<f:convertNumber type="currency" maxFractionDigits="0" locale="es_CL" currencySymbol="$" />
							</h:outputText>
						</p:column>
						<p:column>
							<p:commandButton  icon="ui-icon-disk" title="Guardar" action="#{procesoRebajaValidarMontosController.guardaRebaja}">
                				<f:setPropertyActionListener value="#{_rebaja}" target="#{procesoRebajaValidarMontosController.rebajaSeleccionada}" />
            				</p:commandButton>
						</p:column>

					</p:dataTable>
					<!-- FIN: MODAL CON INFORMACIóN Y FILTROS VISTA ONLINE -->

					<h3>Tareas de la Actividad:</h3>

						<p:commandButton styleClass="x-btn-text" icon="ui-icon-refresh" value="Re Cargar Archivos" actionListener="#{procesoRebajaValidarMontosController.recargarArchivos}" action="bandejaTareas?faces-redirect=true indexMenu=0">
						<f:setPropertyActionListener target="#{procesoRebajaValidarMontosController.target}"
							value="bandejaTareas.jsf" />
						</p:commandButton>
						<p:commandButton styleClass="x-btn-text" icon="ui-icon-refresh" value="Re Calcular Rebaja" actionListener="#{procesoRebajaValidarMontosController.recalcular}" action="bandejaTareas?faces-redirect=true indexMenu=0">
						<f:setPropertyActionListener target="#{procesoRebajaValidarMontosController.target}"
							value="bandejaTareas.jsf" />
							</p:commandButton>
						<p:commandButton styleClass="x-btn-text" icon="ui-icon-check" value="Aceptar Rebaja Calculada" actionListener="#{procesoRebajaValidarMontosController.enviar}" action="bandejaTareas?faces-redirect=true indexMenu=0">
						<f:setPropertyActionListener target="#{procesoRebajaValidarMontosController.target}"
							value="bandejaTareas.jsf" />
							</p:commandButton>


				</p:panel>

				<p:commandButton value="Volver" styleClass="x-btn-text" action="bandejaTareas?faces-redirect=true indexMenu=0" ajax="false"
					icon="ui-icon-seek-first" />
			</p:panel>
		</h:form>
	</ui:define>
</ui:composition>