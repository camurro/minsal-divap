<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" template="/WEB-INF/templates/default.xhtml">

	<ui:define name="content">
		<h:form id="convenios" enctype="multipart/form-data">
			<p:panel styleClass="contentPanel">
				<h1>
					<h:outputText value="Gestión  de Información para Transferencia" />
				</h1>
				<p:panel id="Panel">
					<h2>
						Subir Resoluciones y Convenios por Programa de Reforzamiento Año 2014<br />Servicio de Salud: #{loginController.servicio.nombre_servicio}
					</h2>
					<p class="parrafo">La tarea corresponde a nulla eget ultricies. Morbi pulvinar elit at justo pharetra, vitae ultricies est
						faucibus. Integer id est euismod libero rutrum ultricies. Integer aliquet, sem id commodo.nulla eget ultricies. Morbi pulvinar elit at
						justo pharetra, vitae ultricies est faucibus. Integer id est euismod libero rutrum ultricies. Integer aliquet, sem id commodo.</p>
					<div class="destacaArchivos ui-corner-all">
						
						
					</div>
					<h4>Filtros para la carga de Convenios:</h4>
					<h:panelGrid columns="3">
						<h:panelGrid>
							<h:outputText value="Programa: " styleClass="inputLabel" />
								<p:selectOneMenu id="programa" value="#{procesoConveniosController.programaSeleccionado}" style="width:450px;">
								<f:selectItem itemLabel="Seleccione un programa" itemValue="0" />
					            <f:selectItems itemLabel="#{programa.nombre}" itemValue="#{programa.idProgramaAno}" var="programa" value="#{procesoConveniosController.programas}" />
								<p:ajax listener="#{procesoConveniosController.cargarComponentesPorPrograma}" update="componente datosTabView" />
							</p:selectOneMenu>
						</h:panelGrid>
						<h:panelGrid>
							<h:outputText value="Componente: "  styleClass="inputLabel" />
							<p:selectOneMenu id="componente" value="#{procesoConveniosController.componenteSeleccionado}" style="width:450px;">
								<f:selectItem itemLabel="Seleccione un componente" itemValue="0" />
						   		<f:selectItems itemLabel="#{componente.nombre}" itemValue="#{componente.id}" var="componente" value="#{procesoConveniosController.componentes}" />
						   		<p:ajax listener="#{procesoConveniosController.cargarDatos}" update="datosTabView" />
							</p:selectOneMenu>
						</h:panelGrid>
					</h:panelGrid>
					<br />
					<h:panelGrid id="datosTabView">
					<p:tabView id="tabView" rendered="#{not empty procesoConveniosController.programa}" >
						<p:tab id="tab1" title="APS Municipal" rendered="#{procesoConveniosController.programa.dependenciaMunicipal}">
							<h:panelGrid>
								<h:outputText value="Comuna: " styleClass="inputLabel" />
								<p:selectOneMenu id="comuna" value="#{procesoConveniosController.comunaSeleccionada}" style="width:450px;">
									<f:selectItem itemLabel="Mostrar Todo" itemValue="0" />
									<f:selectItems itemLabel="#{_comuna.descComuna}" itemValue="#{_comuna.idComuna}" var="_comuna" value="#{procesoConveniosController.comunas}" />
									<p:ajax listener="#{procesoConveniosController.cargarDatos}" update="Grid1" />
								</p:selectOneMenu>
							</h:panelGrid>
							<br/>
							<p:dataTable id="Grid1" resizableColumns="true" value="#{procesoConveniosController.resolucionConveniosMunicipal}" liveResize="true" var="_data" rows="10"
								paginator="false" paginatorPosition="bottom" emptyMessage="No se encontro información." styleClass="dataTable">
								<p:columnGroup type="header">
									<p:row>
										<p:column width="15" />
										<p:column headerText="Comuna" />
										<p:column headerText="Programa / Componente" />
										<p:column headerText="Subtítulo" />
										<p:column headerText="Monto" />
										<p:column headerText="Cargar Información" />
									</p:row>
								</p:columnGroup>
								<p:column>
									<p:rowToggler />
								</p:column>
								<p:column>
									<span class="textoAjustado textoPequenio centrado">#{_data.nombreComuna}</span>
								</p:column>
								<p:column>
									<span class="textoAjustado textoPequenio centrado">#{_data.nombrePrograma}/#{_data.nombreComponente}</span>
								</p:column>
								<p:column>
									<span class="textoAjustado textoPequenio centrado">#{_data.nombreSubtitulo}</span>
								</p:column>
								<p:column>
									<h:outputText value="#{_data.monto}" styleClass="textoPequenio textoAjustado">
										<f:convertNumber type="currency" maxFractionDigits="0" locale="es_CL" currencySymbol="$" />
									</h:outputText>
								</p:column>
								<p:column>
									<p:commandButton value="Cargar" action="#{procesoConveniosController.cargaConvenio(11)}" update=":#{p:component('dlg2')}" oncomplete="dlg2.show();" />
								</p:column>
								<p:rowExpansion>
									<!-- INICIO EXPANSION --> 
									    <p:dataTable id="SubGrid1" resizableColumns="true" value="#{procesoConveniosController.resolucionesMunicipal}" liveResize="true" var="_dataMunicipal" rows="10"
										paginator="false" paginatorPosition="bottom" emptyMessage="No se encontro información." styleClass="dataTable">
										<!-- <p:ajax event="rowToggle" listener="#{tableBean.onRowToggle}" update=":form:growl" />   -->
										<p:columnGroup type="header">
											<p:row>
												<p:column headerText="Fecha" />
												<p:column headerText="Número Resolución" />
												<p:column headerText="Monto Final" />
												<p:column headerText="Convenio" />
											</p:row>
										</p:columnGroup>
										<p:column>
											<h:outputText value="#{_dataMunicipal.fecha}" styleClass="textoPequenio textoAjustado">
												<f:convertDateTime pattern="dd/MMM/yyyy" />
											</h:outputText>
										</p:column>
										<p:column>
											<span class="textoAjustado textoPequenio centrado">#{_dataMunicipal.numeroResolucion}</span>
										</p:column>

										<p:column>
											<h:outputText value="#{_dataMunicipal.convenioMonto}" styleClass="textoPequenio textoAjustado">
												<f:convertNumber type="currency" maxFractionDigits="0" locale="es_CL" currencySymbol="$" />
											</h:outputText>
										</p:column>
										<p:column>
											<h:commandLink   action="#{procesoConveniosController.downloadDocAlfresco(_dataMunicipal.idConverio)}">
												<h:graphicImage  value="resources/minsal/images/download-alt.png" styleClass="divapIcons" />
											</h:commandLink >
										</p:column>
									</p:dataTable>
									<!-- FIN EXPANSION -->
								</p:rowExpansion>
							</p:dataTable>
						</p:tab>
						<p:tab id="tab2" title="APS Servicio" rendered="#{procesoConveniosController.programa.dependenciaServicio}">
								<h:panelGrid>
									<h:outputText value="Establecimiento: " styleClass="inputLabel" />
									<p:selectOneMenu id="establecimiento" value="#{procesoConveniosController.establecimientoSeleccionado}" style="width:450px;">
										<f:selectItem itemLabel="Mostrar Todo" itemValue="0" />
										<f:selectItems itemLabel="#{_establecimiento.nombre}" itemValue="#{_establecimiento.id}" var="_establecimiento" value="#{procesoConveniosController.establecimientos}" />
										<p:ajax listener="#{procesoConveniosController.cargarDatos}"  update="Grid2" /> />
									</p:selectOneMenu>
								</h:panelGrid>
								<br/>
								<p:dataTable id="Grid2" resizableColumns="true" value="#{procesoConveniosController.resolucionConveniosServicio}" liveResize="true" var="_data" rows="10"
								paginator="false" paginatorPosition="bottom" emptyMessage="No se encontro información." styleClass="dataTable">
								<!-- <p:ajax event="rowToggle" listener="#{tableBean.onRowToggle}" update=":form:growl" />   -->
								<p:columnGroup type="header">
									<p:row>
										<p:column width="15" />
										<p:column headerText="Establecimiento" />
										<p:column headerText="Programa / Componente" />
										<p:column headerText="Subtítulo" />
										<p:column headerText="Monto" />
										<p:column headerText="Cargar Información" />
									</p:row>
								</p:columnGroup>

								<p:column>
									<p:rowToggler />
								</p:column>
								<p:column>
									<span class="textoAjustado textoPequenio centrado">#{_data.nombreEstablecimiento}</span>
								</p:column>
								<p:column>
									<span class="textoAjustado textoPequenio centrado">#{_data.nombrePrograma}/#{_data.nombreComponente}</span>
								</p:column>
								<p:column>
									<span class="textoAjustado textoPequenio centrado">#{_data.nombreSubtitulo}</span>
								</p:column>
								<p:column>
									<h:outputText value="#{_data.monto}" styleClass="textoPequenio textoAjustado">
										<f:convertNumber type="currency" maxFractionDigits="0" locale="es_CL" currencySymbol="$" />
									</h:outputText>
								</p:column>

								<p:column>
									<p:commandButton value="Cargar"  action="#{procesoConveniosController.cargaConvenio(11)}" update=":#{p:component('dlg2')}" oncomplete="dlg2.show();" />
								</p:column>
								<p:rowExpansion>
										<!-- INICIO EXPANSION --> 
									    <p:dataTable id="SubGrid2" resizableColumns="true" value="#{procesoConveniosController.resolucionesServicios}" liveResize="true" var="_dataServicios" rows="10"
											paginator="false" paginatorPosition="bottom" emptyMessage="No se encontro información." styleClass="dataTable">
										<!-- <p:ajax event="rowToggle" listener="#{tableBean.onRowToggle}" update=":form:growl" />   -->
										<p:columnGroup type="header">
											<p:row>
												<p:column headerText="Fecha" />
												<p:column headerText="Número Resolución" />
												<p:column headerText="Monto Final" />
												<p:column headerText="Convenio" />
											</p:row>
										</p:columnGroup>
										<p:column>
											<h:outputText value="#{_dataServicios.fecha}" styleClass="textoPequenio textoAjustado">
												<f:convertDateTime pattern="dd/MMM/yyyy" />
											</h:outputText>
										</p:column>
										<p:column>
											<span class="textoAjustado textoPequenio centrado">#{_dataServicios.numeroResolucion}</span>
										</p:column>

										<p:column>
											<h:outputText value="#{_dataServicios.convenioMonto}" styleClass="textoPequenio textoAjustado">
												<f:convertNumber type="currency" maxFractionDigits="0" locale="es_CL" currencySymbol="$" />
											</h:outputText>
										</p:column>
										<p:column>
											<h:commandLink   action="#{procesoConveniosController.downloadDocAlfresco(_dataServicios.idConverio)}">
												<h:graphicImage  value="resources/minsal/images/download-alt.png" styleClass="divapIcons" />
												
											</h:commandLink >
										</p:column>
									</p:dataTable>
									<!-- FIN EXPANSION -->
								</p:rowExpansion>
							</p:dataTable>
						</p:tab>
					</p:tabView>
					</h:panelGrid>
					<p:growl id="growl2" showDetail="true" />
					<br />
				</p:panel>
				
				<!-- DIALOG PARA SUBIR LEYES -->
				<p:dialog header="Ingreso de Convenios Leyes" id="leyesDialog" widgetVar="dlg3" modal="true" width="600">
					<h:panelGrid>
						<h:outputText value="Ley: " styleClass="inputLabel" />
						<h:outputText value="RETIRO 20.157" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Subtitulo: " styleClass="inputLabel" />
						<h:outputText value="24" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Comuna: " styleClass="inputLabel" />
						<h:outputText value="Macul" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Fecha de Convenio " styleClass="inputLabel" /><p:calendar></p:calendar>
						<h:outputText value="TOTAL" styleClass="inputLabel" /><h:outputText value="$18.000.000" styleClass="inputLabel" />
					</h:panelGrid>
					<br />
					<div class="destacaArchivos ui-corner-all">
						<br />
						<h:panelGrid>
							<h:outputText value="Subir Convenio: " styleClass="inputLabel" />
							<p:fileUpload id="subirArchivoLeyes" value="#{procesoAsignacionPerCapitaController.valorBasicoDesempenoFile}" mode="simple" />
						</h:panelGrid>
						<br />
					</div>
					<p:commandButton value="Guardar" onclick="dlg3.hide();" styleClass="x-btn-text" icon="ui-icon-disk" />
					<p:commandButton value="Cancelar" onclick="dlg3.hide();" styleClass="x-btn-text" icon="ui-icon-cancel" />
				</p:dialog>
				<p:commandButton value="Volver" styleClass="x-btn-text" action="bandejaTareas?faces-redirect=true indexMenu=0" ajax="false"	icon="ui-icon-seek-first" />
			</p:panel>
			
		
		</h:form>
		
			 <h:form id="fromPupup" enctype="multipart/form-data">
			 	<p:panel styleClass="contentPanel">
					<p:dialog header="Ingreso de Nuevo Convenio" modal="true"  id="dlg2" widgetVar="dlg2" width="600" >
					<h:panelGrid>
						<h:outputText value="Comuna: " styleClass="inputLabel" />
						<h:outputText value="#{procesoConveniosController.convenio.comunaNombre}" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Establecimiento: " styleClass="inputLabel" />
						<h:outputText value="#{procesoConveniosController.convenio.establecimientoNombre}" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Número Resolución: " styleClass="inputLabel" />
						<p:inputText value="#{procesoConveniosController.convenio.numeroResolucion}" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Programa: " styleClass="inputLabel" />
						<h:outputText value="#{procesoConveniosController.convenio.programaNombre}" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Componente: " styleClass="inputLabel" />
						<h:outputText value="#{procesoConveniosController.convenio.componente}" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Subtitulo: " styleClass="inputLabel" />
						<h:outputText value="#{procesoConveniosController.convenio.tipoSubtituloNombreSubtitulo}" />
					</h:panelGrid>
					<h:panelGrid>
						<h:outputText value="Monto: " styleClass="inputLabel" />
						<p:inputText value="#{procesoConveniosController.convenio.convenioMonto}" />
					</h:panelGrid>
					<br />
					<div class="destacaArchivos ui-corner-all">
						<br />
						<h:panelGrid>
							<h:outputText value="Seleccionar Archivo Existente: " styleClass="inputLabel" />
							<p:selectOneMenu id="documento" value="#{procesoConveniosController.documentoSeleccionado}" style="width:450px;">
								<f:selectItem itemLabel="Seleccione un Archivo Existente" itemValue="" />
							  <f:selectItems itemLabel="#{doc.nombreDocu}"  itemValue="#{doc.id}" var="doc" value="#{procesoConveniosController.getDocumentos}" />	
							 </p:selectOneMenu>
						</h:panelGrid>
						<br />

						<h:panelGrid>
						
							<h:outputText value="Subir un nuevo Archivo: " styleClass="inputLabel" />
							<p:fileUpload id="subirArchivo" value="#{procesoConveniosController.plantillaFile}" mode="simple" />
									</h:panelGrid>
						<br />
					</div>
					<p:commandButton value="Guardar" ajax="false" action="#{procesoConveniosController.uploadPopup}"  oncomplete="dlg2.hide();" styleClass="x-btn-text" icon="ui-icon-disk" />
					<p:commandButton value="Cancelar" onclick="dlg2.hide();"  styleClass="x-btn-text" icon="ui-icon-cancel" />
				</p:dialog>
				</p:panel>
			</h:form>
		
		
	</ui:define>
	
</ui:composition>